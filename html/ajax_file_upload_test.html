<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Class test</title>
    <link rel="stylesheet" href="./css/common_style.css">
</head>
<body>

    <div class="container">
        <header>
            <h1>class test</h1>
        </header>

        <div class="main">

            <img src="" alt="" id="img_display">
            <p id="display"></p>
            <form action="" method="POST" id="registerForm" class="column_child centerize" enctype="multipart/form-data">
                <!--<div class="row_child">
                    <label for="user_id">ユーザID（必須）:</label>
                    <input type="text" name="user_id" id="user_id">
                </div>-->

                <div class="row_child">
                    <label for="user_name">ユーザ名（必須）:</label>
                    <input type="text" name="user_name" id="user_name">
                </div>

                <!--<div class="row_child">
                    <label for="user_pwd">パスワード（必須）:</label>
                    <input type="password" name="user_pwd" id="user_pwd">
                </div>

                <div class="row_child">
                    <label for="mail_adrs">メールアドレス（必須）:</label>
                    <input type="email" name="mail_adrs" id="mail_adrs">
                </div>-->

                <div class="row_child">
                    <label for="profile_img">プロフィール画像:</label>
                    <input type="file" name="profile_img" id="profile_img" accept="image/*">
                </div>

                <!--<div class="row_child">
                    <label for="profile_text">自己紹介文:</label>
                    <input type="textarea" name="profile_text" id="profile_text">
                </div>-->
            </form>
            <button id="btnRegistDataSubmit">登録</button>
            
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script>

    let file;
    // let image = new Image();
    let fileReader = new FileReader();
    $('#profile_img').on('change', function(ev){
        // alert('file select');
        console.dir(ev);
        file = ev.currentTarget.files[0];

        

       

        fileReader.onload = function(){

            let dataUri = this.result;

            $('#img_display').prop('src',dataUri);

        };

        fileReader.readAsDataURL(file);
    });
        
        $('#btnRegistDataSubmit').on('click',function(ev){

            console.log('pushed');

            // let fd = new FormData(document.getElementById('registerForm'));
            
            // fd.append($('#user_name').attr('name'),$('#user_name').val());
            // console.log($('#profile_img')[0]);
            // fd.append('filename',file.name);
            // fd.append('file',fileReader);
            // console.log('----file---');
            // console.dir(fd.getAll());

            var fd = new FormData();
            if ($("#profile_img").val()!== '') {
                fd.append( "file", $("#profile_img").prop("files")[0] );
            }
            fd.append("dir",$("#profile_img").val());

             $.ajax({
                type:"POST",
                url:'../POSTFileTest.php',
                data:fd,
                processData:false,
                contentTyp:false
            }).done(function(res){
                console.log(res);
                $("#display").append(res);

            }).fail(function(jqXHR,textStatus,errorThrown){
                console.log('ERROR',jqXHR,textStatus,errorThrown);
            });

        });

    </script>
   
    
</body>
</html>